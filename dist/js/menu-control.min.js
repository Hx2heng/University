requirejs.config({paths:{jquery:"../lib/js/jquery.min",dad:"../lib/js/jquery.dad.min"}}),define(["jquery","dad"],function(t,e){function i(e,i,n){this.ele=t(e),this.new_data=[],this.config={type:[{name:"默认",valt:0},{name:"类型一",valt:1},{name:"类型二",valt:0}],limit:[3,4]},this.handler={},arguments[2]?this.data=n:this.data=[{id:1,pId:0,type:1,text:"我的菜单"}],t.extend(this.config,i)}return i.prototype={setData:function(t){return t&&(this.data=t),this.data},create:function(){var e=this.config,i=this.data,n=[],l=[],a=[],s=0;n.ele=t('<ul class="list-group ul-1"></div>');var p=t("<div class='ul-title'><p>一级菜单</p><div class='icon-btn-group'><span class='glyphicon glyphicon-plus icon-btn' aria-hidden='true'></span></div></div>"),d=t('<div class="li-1-content"></div>"');this.options="";for(var o=0;o<e.type.length;o++)this.options=this.options+"<option>"+e.type[o].name+"</option>",0==e.type[o].valt&&(e.type[o].valn="key"),1==e.type[o].valt&&(e.type[o].valn="url");this.ele.append(n.ele),n.ele.append(p),n.ele.append(d);for(var o=0;o<i.length;o++)0==i[o].pId&&l.push(i[o].id);l.sort();for(var o=0;o<l.length;o++)for(var c=0;c<i.length;c++)i[c].id==l[o]&&n.push(i[c]);for(var o=0;o<n.length;o++)n[o].ele=t("<li class='list-group-item li-1'></li>"),n[o].ele.ul_2=t('<ul class="list-group ul-2"><div class="ul-title"><p>二级菜单</p><div class="icon-btn-group"><span class="glyphicon glyphicon-plus icon-btn" aria-hidden="true"></span></div></div></div>'),n[o].ele.ul_2.li_2_content=t('<div class="li-2-content"></div>'),n[o].ele.ul_2.append(n[o].ele.ul_2.li_2_content),n[o].ele.ul_2.eles=[],d.append(n[o].ele),n[o].ele.attr("type-index",n[o].type),0==e.type[n[o].type].valt&&(n[o].val=n[o].key),1==e.type[n[o].type].valt&&(n[o].val=n[o].url),n[o].ele.append('<div class ="li-data"><p><span class="data-text">'+n[o].text+'</span><span class="data-type">'+e.type[n[o].type].name+'</span><span class="data-val">'+n[o].val+'</span></p><div class="icon-btn-group"><span class="glyphicon glyphicon-pencil icon-btn edit" aria-hidden="true"></span><span class="glyphicon glyphicon-move icon-btn dad1" aria-hidden="true"></span><span class="glyphicon glyphicon-trash icon-btn delete" aria-hidden="true"></span></div></div>'),n[o].ele.append('<div class="li-set" ><div class="input-group"><input type="text" class="form-control text" placeholder="1"><span class="input-group-btn"><button class="btn btn-default confirm" type="button">确定</button><button class="btn btn-default cancel" type="button">取消</button></span></div><div class="input-group li-type-set"><span class="input-group-btn"><select class="form-control data-option" style="width: auto;">'+this.options+'</select></span><input type="text" class="form-control val" placeholder="1" val='+e+"></div></div>"),n[o].ele.append(n[o].ele.ul_2);for(var o=0;o<i.length;o++)1==i[o].pId&&a.push(i[o].id);a.sort();for(var o=0;o<a.length;o++)for(var c=0;c<i.length;c++)i[c].id==a[o]&&(s=i[c].id.toString().charAt(0)-1,n[s].ele.ul_2.eles.push(i[c]));for(var o=0;o<n.length;o++)for(var c=0;c<n[o].ele.ul_2.eles.length;c++)n[o].ele.ul_2.eles[c].ele=t("<li class='list-group-item li-2'></li>"),n[o].ele.ul_2.li_2_content.append(n[o].ele.ul_2.eles[c].ele),n[o].ele.ul_2.eles[c].ele.attr("type-index",n[o].ele.ul_2.eles[c].type),0==e.type[n[o].ele.ul_2.eles[c].type].valt&&(n[o].ele.ul_2.eles[c].val=n[o].ele.ul_2.eles[c].key),1==e.type[n[o].ele.ul_2.eles[c].type].valt&&(n[o].ele.ul_2.eles[c].val=n[o].ele.ul_2.eles[c].url),n[o].ele.ul_2.eles[c].ele.append('<div class ="li-data"><p><span class="data-text">'+n[o].ele.ul_2.eles[c].text+'</span><span class="data-type">'+e.type[n[o].ele.ul_2.eles[c].type].name+'</span><span class="data-val">'+n[o].ele.ul_2.eles[c].val+'</span></p><div class="icon-btn-group"> <span class="glyphicon glyphicon-pencil icon-btn edit" aria-hidden="true"></span><span class="glyphicon glyphicon-move icon-btn dad" aria-hidden="true"></span><span class="glyphicon glyphicon-trash icon-btn delete" aria-hidden="true"></span></div></div>'),n[o].ele.ul_2.eles[c].ele.append('<div class="li-set" ><div class="input-group"><input type="text" class="form-control text" placeholder="1"><span class="input-group-btn"><button class="btn btn-default confirm" type="button">确定</button><button class="btn btn-default cancel" type="button">取消</button></span></div><div class="input-group li-type-set"><span class="input-group-btn"><select class="form-control data-option" style="width: auto;">'+this.options+'</select></span><input type="text" class="form-control val" placeholder="1" val='+e+"></div></div>")},init:function(){this.ele.empty(),this.setData(),this.create(),this.control(),this.itemAdd(),this.outData()},control:function(){var e=this;t(".ul-title").unbind("mouseover").on("mouseover",function(){t(this).children(".icon-btn-group").stop().fadeIn(200)}),t(".ul-title").unbind("mouseleave").on("mouseleave",function(){t(this).children(".icon-btn-group").stop().fadeOut(200)}),t(".ul-1 li").unbind("mouseover").on("mouseover",function(){t(this).children().children(".icon-btn-group").stop().fadeIn(200),t(this).children(".li-data").find(".data-val").stop().fadeIn(200)}),t(".ul-1 li").unbind("mouseleave").on("mouseleave",function(){t(this).children().children(".icon-btn-group").stop().fadeOut(200),t(this).children(".li-data").find(".data-val").stop().fadeOut(200)}),t(".data-option").css({width:"auto"}),t(".edit").unbind("click").on("click",function(){t(this).parents(".li-data").slideUp(200),t(this).parents(".li-data").siblings(".li-set").css({display:"block"}),t(this).parents(".li-data").siblings(".li-set").find(".text").val(t(this).parents(".li-data").find(".data-text").text()),t(this).parents(".li-data").siblings(".li-set").find(".val").val(t(this).parents(".li-data").find(".data-val").text()),t(this).parents(".li-data").siblings(".li-set").find(".data-option").val(t(this).parents(".li-data").find(".data-type").text()),e.outData(),e.fire("dataChange")}),t(".cancel").unbind("click").on("click",function(){t(this).parents(".li-set").slideUp(),t(this).parents(".li-set").siblings(".li-data").slideDown()}),t(".confirm").unbind("click").on("click",function(){var i=t(this).parents(".li-set").find(".text").val(),n=t(this).parents(".li-set").find(".data-option").val(),l=t(this).parents(".li-set").find(".val").val(),a=t(this).parents(".li-set").find(".data-option").prop("selectedIndex"),s=t(this).parents(".li-set").eq(0).siblings(".li-data").find(".data-text"),p=t(this).parents(".li-set").eq(0).siblings(".li-data").find(".data-type"),d=t(this).parents(".li-set").eq(0).siblings(".li-data").find(".data-val"),o=t(this).parents("li").eq(0);i||""!=i?(s.text(i),p.text(n),d.text(l),o.attr("type-index",a),t(this).parents(".li-set").slideUp(),t(this).parents(".li-set").siblings(".li-data").slideDown()):alert("请输入菜单名"),e.outData(),e.fire("dataChange")}),t(".delete").unbind("click").on("click",function(){t(this).parents("li").eq(0).remove(),e.outData(),e.fire("dataChange")}),this.itemAdd(),this.fire("init")},itemAdd:function(){var e=this;t(".ul-1").children(".ul-title").children(".icon-btn-group").children(".glyphicon-plus").unbind("click").on("click",function(){t(this).parents(".ul-1").children().children("li").length>e.config.limit[0]-1?e.fire("overlimit1",e.config.limit[0]):(t(".ul-1").find(".li-1-content").append("<li class='list-group-item li-1' type-index='0'><div class ='li-data'><p><span class='data-text'>新菜单</span><span class='data-type'>"+e.config.type[0].name+"</span></p><div class='icon-btn-group'> <span class='glyphicon glyphicon-pencil icon-btn edit' aria-hidden='true'></span><span class='glyphicon glyphicon-move icon-btn dad1' aria-hidden='true'></span><span class='glyphicon glyphicon-trash icon-btn delete' aria-hidden='true'></span></div></div><div class='li-set' ><div class='input-group'><input type='text' class='form-control text' placeholder='1'><span class='input-group-btn'><button class='btn btn-default confirm' type='button'>确定</button><button class='btn btn-default cancel' type='button'>取消</button></span></div><div class='input-group li-type-set'><span class='input-group-btn'><select class='form-control data-option' style='width: auto;'>"+this.options+"</select></span><input type='text' class='form-control val' placeholder='1' val=''></div></div></div><ul class='list-group ul-2'><div class='ul-title'><p>二级菜单</p><div class='icon-btn-group'><span class='glyphicon glyphicon-plus icon-btn' aria-hidden='true'></span></div></div><div class='li-2-content'></div></ul></li>"),e.control(),e.fire("dataChange"))}),t(".ul-2").children(".ul-title").children(".icon-btn-group").children(".glyphicon-plus").unbind("click").on("click",function(){t(this).parents(".ul-2").find("li").length>e.config.limit[1]-1?e.fire("overlimit2",e.config.limit[1]):(t(this).parents(".ul-2").find(".li-2-content").append("<li class='list-group-item li-2' type-index='0'><div class ='li-data'><p><span class='data-text'>新菜单</span><span class='data-type'>"+e.config.type[0].name+"</span></p><div class='icon-btn-group'> <span class='glyphicon glyphicon-pencil icon-btn edit' aria-hidden='true'></span><span class='glyphicon glyphicon-move icon-btn dad' aria-hidden='true'></span><span class='glyphicon glyphicon-trash icon-btn delete' aria-hidden='true'></span></div></div><div class='li-set' ><div class='input-group'><input type='text' class='form-control text' placeholder='1'><span class='input-group-btn'><button class='btn btn-default confirm' type='button'>确定</button><button class='btn btn-default cancel' type='button'>取消</button></span></div><div class='input-group li-type-set'><span class='input-group-btn'><select class='form-control data-option' style='width: auto;'>"+this.options+"</select></span><input type='text' class='form-control val' placeholder='1' val=''></div></div></li>"),e.control(),e.fire("dataChange"))})},outData:function(){this.new_data=[];for(var t=this.config,e=[],i=this.ele.find(".ul-1"),n=i.children(".li-1-content").children("li"),l=0;l<n.length;l++){n[l].dpId=0,n[l].did=1+l,n[l].dtext=n.eq(l).find(".data-text").eq(0).text(),n[l].dtype=n.eq(l).attr("type-index"),0==t.type[n[l].dtype].valt&&(n[l].dkey=n.eq(l).find(".data-val").eq(0).text()),1==t.type[n[l].dtype].valt&&(n[l].durl=n.eq(l).find(".data-val").eq(0).text()),n[l].li_2=n.eq(l).find("li"),e.push(n[l]);for(var a=0;a<n[l].li_2.length;a++)n[l].li_2[a].dpId=1,n[l].li_2[a].did=10*(l+1)+a+1,n[l].li_2[a].dtext=n.eq(l).find("li").eq(a).find(".data-text").eq(0).text(),n[l].li_2[a].dtype=n.eq(l).find("li").eq(a).attr("type-index"),0==t.type[n[l].li_2[a].dtype].valt&&(n[l].li_2[a].dkey=n.eq(l).find("li").eq(a).find(".data-val").eq(0).text()),1==t.type[n[l].li_2[a].dtype].valt&&(n[l].li_2[a].durl=n.eq(l).find("li").eq(a).find(".data-val").eq(0).text()),e.push(n[l].li_2[a])}for(var l=0;l<e.length;l++)this.new_data[l]={id:e[l].did,pId:e[l].dpId,type:e[l].dtype,text:e[l].dtext,key:e[l].dkey,url:e[l].durl};return this.new_data},on:function(t,e){"undefined"==typeof this.handler[t]&&(this.handler[t]=[]),this.handler[t].push(e)},fire:function(t,e){if(this.handler[t]instanceof Array)for(var i=this.handler[t],n=0;n<i.length;n++)i[n](e)}},i});